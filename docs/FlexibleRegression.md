# Flexible Regression


## (Orthogonal) polynomial regression

The library contains code for generating polynomial regression basis functions in the object `Basis`. Their use for flexible smoothing and interpolation is illustrated below. First some imports

```scala
import breeze.linalg._
import breeze.numerics._
import breeze.stats.distributions.Gaussian
import scalaglm._
```

Next simulate some synthetic data, and plot it.
```scala
val n = 500
// n: Int = 500
val x = linspace(2.0, 5.0, n)
// x: DenseVector[Double] = DenseVector(2.0, 2.006012024048096, 2.012024048096192, 2.0180360721442887, 2.024048096192385, 2.030060120240481, 2.036072144288577, 2.0420841683366735, 2.0480961923847696, 2.0541082164328657, 2.0601202404809618, 2.0661322645290583, 2.0721442885771544, 2.0781563126252505, 2.0841683366733466, 2.090180360721443, 2.096192384769539, 2.1022044088176353, 2.1082164328657313, 2.1142284569138274, 2.120240480961924, 2.12625250501002, 2.132264529058116, 2.1382765531062122, 2.1442885771543088, 2.150300601202405, 2.156312625250501, 2.162324649298597, 2.1683366733466936, 2.1743486973947896, 2.1803607214428857, 2.186372745490982, 2.1923847695390783, 2.1983967935871744, 2.2044088176352705, 2.2104208416833666, 2.2164328657314627, 2.2224448897795592, 2.2284569138276553, 2.2344689378757514, 2.2404809619238475, 2.246492985971944, 2.25250501002004, 2.258517034068136, 2.2645290581162323, 2.270541082164329, 2.276553106212425, 2.282565130260521, 2.288577154308617, 2.2945891783567136, 2.3006012024048097, 2.306613226452906, 2.312625250501002, 2.318637274549098, 2.3246492985971945, 2.3306613226452906, 2.3366733466933867, 2.342685370741483, 2.3486973947895793, 2.3547094188376754, 2.3607214428857715, 2.3667334669338675, 2.372745490981964, 2.37875751503006, 2.3847695390781563, 2.3907815631262523, 2.396793587174349, 2.402805611222445, 2.408817635270541, 2.414829659318637, 2.420841683366733, 2.4268537074148298, 2.432865731462926, 2.438877755511022, 2.4448897795591185, 2.4509018036072145, 2.4569138276553106, 2.4629258517034067, 2.468937875751503, 2.4749498997995993, 2.4809619238476954, 2.4869739478957915, 2.4929859719438876, 2.498997995991984, 2.50501002004008, 2.5110220440881763, 2.5170340681362724, 2.5230460921843685, 2.529058116232465, 2.535070140280561, 2.541082164328657, 2.5470941883767537, 2.55310621242485, 2.559118236472946, 2.565130260521042, 2.571142284569138, 2.5771543086172346, 2.5831663326653307, 2.5891783567134268, 2.5951903807615233, 2.6012024048096194, 2.6072144288577155, 2.6132264529058116, 2.6192384769539077, 2.6252505010020037, 2.6312625250501003, 2.6372745490981964, 2.6432865731462925, 2.649298597194389, 2.655310621242485, 2.661322645290581, 2.6673346693386772, 2.6733466933867733, 2.67935871743487, 2.685370741482966, 2.691382765531062, 2.6973947895791586, 2.7034068136272547, 2.7094188376753507, 2.715430861723447, 2.721442885771543, 2.727454909819639, 2.7334669338677355, 2.7394789579158316, 2.7454909819639277, 2.7515030060120242, 2.7575150300601203, 2.7635270541082164, 2.7695390781563125, 2.7755511022044086, 2.781563126252505, 2.787575150300601, 2.7935871743486973, 2.799599198396794, 2.80561122244489, 2.811623246492986, 2.817635270541082, 2.823647294589178, 2.8296593186372743, 2.835671342685371, 2.841683366733467, 2.847695390781563, 2.8537074148296595, 2.8597194388777556, 2.8657314629258517, 2.8717434869739478, 2.877755511022044, 2.8837675350701404, 2.8897795591182365, 2.8957915831663326, 2.901803607214429, 2.907815631262525, 2.9138276553106213, 2.9198396793587174, 2.9258517034068134, 2.93186372745491, 2.937875751503006, 2.943887775551102, 2.9498997995991982, 2.9559118236472948, 2.961923847695391, 2.967935871743487, 2.973947895791583, 2.979959919839679, 2.9859719438877756, 2.9919839679358717, 2.997995991983968, 3.0040080160320644, 3.0100200400801604, 3.0160320641282565, 3.0220440881763526, 3.0280561122244487, 3.034068136272545, 3.0400801603206413, 3.0460921843687374, 3.052104208416834, 3.05811623246493, 3.064128256513026, 3.070140280561122, 3.0761523046092183, 3.0821643286573144, 3.088176352705411, 3.094188376753507, 3.100200400801603, 3.1062124248496996, 3.1122244488977957, 3.118236472945892, 3.124248496993988, 3.130260521042084, 3.13627254509018, 3.1422845691382766, 3.1482965931863727, 3.154308617234469, 3.1603206412825653, 3.1663326653306614, 3.1723446893787575, 3.1783567134268536, 3.1843687374749496, 3.190380761523046, 3.1963927855711423, 3.202404809619239, 3....
val yt = 0.5*x + sin(x*x)
// yt: DenseVector[Double] = DenseVector(0.2431975046920718, 0.23068200961147334, 0.21856991982154694, 0.20687414200938026, 0.19560748190708044, 0.18478263220677704, 0.17441216030732531, 0.16450849590063166, 0.15508391840596436, 0.1461505442609926, 0.13772031407870866, 0.12980497967979798, 0.12241609101041384, 0.11556498295573414, 0.10926276206008123, 0.10352029316478395, 0.09834818597537909, 0.09375678157013234, 0.08975613886228828, 0.086356021028826, 0.0835658819189109, 0.08139485245561684, 0.07985172704487342, 0.07894495000598245, 0.0786826020384076, 0.07907238673991901, 0.08012161719152355, 0.08183720262496785, 0.08422563518893811, 0.0872929768304096, 0.09104484630792675, 0.0954864063538915, 0.10062235100324268, 0.10645689310618767, 0.11299375204292172, 0.1202361416585147, 0.12818675843639482, 0.136847769929076, 0.14622080346497834, 0.15630693515038718, 0.16710667918575195, 0.17861997751568515, 0.19084618983214308, 0.20378408395038583, 0.2174318265773807, 0.23178697449239472, 0.24684646615953976, 0.2626066137920753, 0.2790630958882133, 0.29621095025818456, 0.3140445675622128, 0.33255768537899044, 0.35174338282408457, 0.3715940757375763, 0.3921015124600592, 0.41325677021586926, 0.435050252122242, 0.4574716848427326, 0.48051011690298584, 0.5041539176865975, 0.5283907771283756, 0.5532077061219685, 0.5785910376583348, 0.6045264287110551, 0.6309988628839965, 0.6579926538362336, 0.6854914494985855, 0.7134782370954753, 0.7419353489851827, 0.7708444693307962, 0.800186641613515, 0.8299422769991041, 0.8600911635675186, 0.8906124764148929, 0.9214847886361222, 0.9526860831954032, 0.9841937656911489, 1.015984678020596, 1.0480351129485066, 1.0803208295832085, 1.1128170697621405, 1.1454985753479416, 1.1783396064349008, 1.211313960464413, 1.244394992246828, 1.2775556348858121, 1.3107684216000095, 1.3440055084354863, 1.37723869786106, 1.4104394632372081, 1.4435789741478902, 1.476628122583077, 1.5095575499583986, 1.5423376749568132, 1.574938722175653, 1.6073307515609139, 1.6394836886091095, 1.671367355315423, 1.702951501845367, 1.7342058389055128, 1.7651000707873254, 1.7956039290565124, 1.8256872068586887, 1.855319793810571, 1.8844717114443128, 1.913113149170993, 1.9412145007276642, 1.9687464010708313, 1.9956797636775918, 2.0219858182141714, 2.047636148530045, 2.0726027309342734, 2.0968579727092456, 2.1203747508155266, 2.1431264507400636, 2.165087005438642, 2.1862309343220687, 2.206533382234256, 2.2259701583691336, 2.2445177750719996, 2.262153486469827, 2.2788553268738485, 2.2946021488966966, 2.309373661225362, 2.3231504659902855, 2.335914095670007, 2.3476470494699964, 2.3583328291135737, 2.367955973982131, 2.3765020955413334, 2.383957910989463, 2.390311276063691, 2.395551216939732, 2.3996679611601426, 2.4026529675263912, 2.4044989548898426, 2.405199929776854, 2.4047512127834096, 2.4031494636750175, 2.400392705128006, 2.3964803450489134, 2.3914131974092987, 2.385193501534096, 2.3778249397825193, 2.3693126535615496, 2.359663257613197, 2.3488848525179873, 2.3369870353585505, 2.3239809084887133, 2.3098790863551635, 2.294695700320579, 2.2784464014390293, 2.2611483611365317, 2.242820269751863, 2.2234823328950477, 2.2031562655834414, 2.181865284117912, 2.1596340956643645, 2.1364888855087587, 2.112457301956712, 2.087568438852002, 2.061852815691391, 2.0353423553167858, 2.008070359169037, 1.9800714800914665, 1.9513816926748568, 1.9220382611395204, 1.8920797047540439, 1.8615457607943457, 1.8304773450508116, 1.7989165098956459, 1.76690639992678, 1.73449120520924, 1.7017161121392992, 1.6686272519613912, 1.635271646972326, 1.601697154452195, 1.567952408365935, 1.5340867588845086, 1.5001502097793582, 1.4661933537487335, 1.432267305739382, 1.398423634331965, 1.364714291263458, 1.331191539164757, 1.297907877596545, 1.26491596747126, 1.232268553954008, 1.2000183879398298, 1.168218146209575, 1.1369203503712528, 1.1061772846982656, 1.0760409129804254, 1.0465627945080884, 1.0177939993138538, 0.989785022800609,...
val y = yt + DenseVector(Gaussian(0.0, 1.0).sample(n).toArray)
// y: DenseVector[Double] = DenseVector(-0.5264333029593138, 1.8787382787869888, 0.5433407453510541, 1.0529029577470919, 0.2889110038622888, 2.969463433019389, 1.296869162870491, 0.5310366909106711, -0.13884628918983732, 0.8034967969550566, 1.1615982744757307, 0.020293986989913346, -1.133425114185565, -0.38137308413253296, -0.18480958467918246, 0.9962103380621778, 0.6244648080093607, 0.3871816769095606, 0.1794778743900603, 1.1126332013203197, -0.3070560224878151, 0.460000125737093, -0.9565546622339637, 0.8514721984455657, 0.6667386949143449, -1.269110289680446, 0.8573556364310955, 0.6935110067653919, -0.9961938577960585, -1.3907979690744197, 0.3046525651265335, -0.381405569537701, 2.3018860085113424, 0.8253694316499068, -1.5533393093700871, -0.41710966560956475, 1.1597802068896352, -0.1557531446370401, 1.3958580900429383, 0.7133347934649757, -0.009405730624001046, 2.1217296928914204, 0.5474511792445287, 0.21675285951011583, 0.7430659655139175, -0.6602521526253522, 0.8413238063932517, 1.269127264985678, -1.1691055470252723, -0.8943792228146042, 2.125356220397635, 0.7953375303398027, -0.6455725694306439, -1.3513840347139903, 1.8780142007288974, -0.2928327364057691, -1.0943319130327755, 1.9077819664685345, 0.4210738458244237, -0.17134018176511356, 1.707767231880708, -0.13675922490503556, 0.8616598695706182, -0.47067833482165533, 0.9629167169187884, -0.945705866917767, 0.6785756160050116, 0.96789827597648, 1.6424252544594062, 0.933710370122746, 0.16870242302840766, 1.0941397398826882, 0.12640074493904108, 2.368566652480911, -0.39148134740967544, 0.1096595549605901, 0.7188691406505338, 2.534579049571744, 1.124433892598059, 2.861022121467272, 2.567582115524202, -0.7184338941122357, -0.23495643126827992, 2.3896202442046555, 3.143526506065255, 0.6928963181393386, 2.4797439191169843, 2.75468741858176, 2.1099041998546735, 2.2401264569692945, 2.9401906447312864, 0.5624038258640403, 3.045154333725492, 1.814613176933352, 0.7736008626089697, 1.720557013754271, 1.8441080910272916, 1.164822795804426, 3.052174299140815, 0.31339499946852145, 2.2677000038903334, 3.617811681268294, 2.648848581280657, 1.0007692854864034, 1.737424575964676, 3.391758026565461, 2.65833645186162, 2.382876726951328, 2.132708718726178, 0.6036387410081072, 1.5580874197142187, 3.9591966562519754, 2.0411340983685013, 1.47835991275703, 2.825642576427116, 2.677341505056334, 3.0681193269246836, 4.2928856812100955, 2.2340758678959896, 1.3624570759564847, 2.2351460799572447, 3.9624222545246464, 1.9828854341178768, 2.386408744477726, 1.8425356347555923, 2.748611947480586, 1.5098417968240136, 2.387323492738467, 4.006223908381857, 1.8776400545071412, 3.5016808427289936, 1.2176787778129272, 2.108831515403614, 2.314706505007636, 3.5467058508464824, 0.9508509511747525, 3.9157119307536474, 3.201034267557499, 1.945061195573318, 1.1237633676296355, 4.619721968064487, 2.9596389335031046, 1.2807199590223204, 2.640197919185536, -0.3067275471885642, 2.5979710934035096, 4.464034028260748, 2.248153786462983, 2.2671128136192915, 3.1231936448568223, 3.5664534337098077, 2.9856967090399875, 2.8863274548432925, 3.125550380951479, 1.7325317909653917, 2.955710829244576, 1.8981649950739627, 1.2693078803125848, 2.1051710456405637, 2.516094946562572, 2.434426674480401, 2.7693212932434803, 2.0890295808026256, 2.947931107609311, 0.6907605817322893, 0.905180147341601, 2.384178487156903, 1.3736575151410384, 1.4052200573640297, 0.3273900265942178, 1.6494869784878277, 1.1956839701590138, 2.295781091275048, 2.4642808593464736, 2.2187358686024785, -0.11699061135092892, 2.7659653956122368, 0.9467958759734733, 0.021896511272260666, 1.5953803063913958, 0.5961147498264285, 1.1692078867580564, 0.5073285410237817, 2.7169262281916775, 1.2522483447969563, 1.2993147171053412, 0.2537514872663218, 1.4117667413441624, -0.26519193881430003, 0.3100073407878918, 1.4179184651625827, 1.5928152668060813, 0.8742754273371797, -1.738286680478386, 2.9193086600345897, 1.22910463707...

import breeze.plot._
val fig = Figure("Synthetic data")
// fig: Figure = breeze.plot.Figure@4edf359c
val p = fig.subplot(3,1,0)
// p: Plot = breeze.plot.Plot@536b1dfd
p += plot(x, y, '+', name="Data")
// res0: Plot = breeze.plot.Plot@536b1dfd
p += plot(x, yt, name="Truth")
// res1: Plot = breeze.plot.Plot@536b1dfd
```

Next add some polynomial fits, using `Basis.poly` to generate the necessary covariate matrix.

```scala
(1 to 17 by 4).foreach(i => {
	val lm = Lm(y, Basis.poly(x, i))
	p += plot(x, lm.fitted, name="P"+i)
})
p.legend = true
p.title = "Polynomial fits"
```

That's it!

## Cosine series regression

If you prefer a spectral approach to non-parametric regression, you can use cosine series instead.
Lets re-use the previous data, but start a new plot.

```scala
val p2 = fig.subplot(3,1,1)
// p2: Plot = breeze.plot.Plot@6541aa6c
p2 += plot(x, y, '+', name="Data")
// res5: Plot = breeze.plot.Plot@6541aa6c
p2 += plot(x, yt, name="Truth")
// res6: Plot = breeze.plot.Plot@6541aa6c
```

Next add some cosine series fits, using `Basis.cosine` to generate the necessary covariate matrix.

```scala
(1 to 9 by 2).foreach(i => {
	val lm = Lm(y, Basis.cosine(x, i))
	p2 += plot(x, lm.fitted, name="C"+i)
})
p2.legend = true
p2.title = "Cosine fits"
```

## B-splines

Here, we instead use B-splines to get a flexible fit. We use 10 interior knots, and consider linear, quadratic and cubic B-spline basis functions.
```scala
val p3 = fig.subplot(3,1,2)
// p3: Plot = breeze.plot.Plot@6d00a840
p3 += plot(x, y, '+', name="Data")
// res10: Plot = breeze.plot.Plot@6d00a840
p3 += plot(x, yt, name="Truth")
// res11: Plot = breeze.plot.Plot@6d00a840
(1 to 3).foreach(i => {
	val lm = Lm(y, Basis.bs(x, i)(linspace(2.2,4.8,10).data.toIndexedSeq))
	p3 += plot(x, lm.fitted, name="B"+i)
})
p3.legend = true
p3.title = "B-spline fits"
```
